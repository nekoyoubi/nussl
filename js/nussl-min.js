/*!
 * nussl.js v0.2.0
 * https://github.com/nekoyoubi/nussl/js/nussl.js
 * (c) 2024 http://nekoyoubi.com
 * Released under the MIT License.
 * 
 * ElementWatcher example usage:
 * always().when("button").gets("click").then(element => element.classList.toggle("active"));
 * always().when("button", "input.button").gets("click").after(1000, element => element.classList.toggle("active"));
 * always().when("h1,h2,h3,h4,h5,h6").gets("mouseenter").then(element => element.classList.add("highlight")).and().gets("mouseleave").after(250, element => element.classList.remove("highlight"));
 * once().when("body").gets("load").trigger("click").on("#show-login");
 * only(el => (el.type === "password" ?? false) && window.location.protocol === "https:").when("#login-password").gets("mouseenter").then(element => { element.type = "text"; element.addEventListener("mouseleave", () => element.type = "password"); });
 * only(el => el.innerText?.includes("about") ?? false).when("h1", "h2").exists(elements => elements.forEach(element => console.log(`Header containing 'about' found: ${element}`)));
 * until().any("#element1", "#element2").exists(elements => elements.forEach(element => console.log(`Element found: ${element}`)));
 * until().all("#element1", "#element2").exists(elements => alert("All elements found!"));
 * unless().any("#element1", "#element2").exists(elements => alert("No elements found!"));
 * 
 * ElementManager example usage:
 * find("button").set({ id: "submit-button", class: "btn btn-primary", innerText: "Submit"});
 * find("#ad-row").hide();
 * find("#ad-row").remove();
 * replace("#ad-row").with("div").set({ id: "info-row", class: "row" });
 * create("div").set({ id: "addon-container", class: "container" }).on("body");
 * find("#submit-button") // .or() segment is bypassed on found; .then() segment is applied to either found or created element
 * 	.or().create("button").on("#login-form").set({ id: "submit-button", class: "btn btn-primary", innerText: "Submit" })
 * 	.then().set({ class__$: "btn-lg bg-blue-500" });
 * find("#submit-button").move("form");
 * create("span").set({ id: "error-message", innerText: "An error occurred." }).move("body").up(9999);
 * create("button").set({ id: "alert-button", innerText: "Alert!" }).on("body").up(12345).listen("click", () => alert("Button clicked!"));
 * use(document.querySelector("#alert-button")).hide();
 */
class ElementWatcher{constructor(){this.eventHandlers=[],this.chain=[],this.selectors=[]}static always(){return new ElementWatcher}static once(){const e=new ElementWatcher;return e.once=!0,e}static until(){const e=new ElementWatcher;return e.until=!0,e}static only(e){const t=new ElementWatcher;return t.condition=e??(()=>!0),t}static unless(){const e=new ElementWatcher;return e.unless=!0,e}when(...e){return this.selectors=e,this}gets(e){return this.chain.push({event:e}),this}after(e,t){const n=this.chain[this.chain.length-1];return n&&(n.delay=e,n.callback=t),this.processElements(!1),this}then(e){const t=this.chain[this.chain.length-1];return t&&(t.callback=e),this.processElements(!1),this}and(){return this}exists(e){return this.callback=e,this.processElements(!0),this}trigger(e){return this.triggerEventName=e,this}on(e){return this.targetSelector=e,this.processElements(!1),this}all(...e){return this.selectors=e,this.requireAll=!0,this}any(...e){return this.selectors=e,this.requireAny=!0,this}processElements(e){const t=()=>{const t=this.selectors.map((e=>Array.from(document.querySelectorAll(e)))),n=t.flat(),s=t.filter((e=>e.length>0)).length;e?this.requireAll&&s===this.selectors.length||this.requireAny&&n.length>0?"function"==typeof this.callback&&this.callback(n):this.unless&&0===n.length&&"function"==typeof this.callback&&this.callback():n.forEach((e=>{this.condition&&!this.condition(e)||this.chain.forEach((t=>{const{event:n,delay:s,callback:i}=t;if(e.addEventListener(n,(t=>{s?setTimeout((()=>i&&i(e,t)),s):i&&i(e,t)}),{once:this.once}),this.triggerEventName&&this.targetSelector){const t=document.querySelector(this.targetSelector);t&&e.addEventListener(n,(()=>t.dispatchEvent(new Event(this.triggerEventName))),{once:this.once})}}))}))};new MutationObserver(((n,s)=>{t(),this.once&&e&&s.disconnect()})).observe(document.body,{childList:!0,subtree:!0}),e&&t()}}const always=ElementWatcher.always,once=ElementWatcher.once,until=ElementWatcher.until,only=ElementWatcher.only,unless=ElementWatcher.unless;class ElementManager{constructor(){this.element=null,this.found=!1,this.bypass=!1,this.replaced=null}static find(e){return(new ElementManager).find(e)}static create(e){return(new ElementManager).create(e)}static replace(e){return(new ElementManager).replace(e)}static use(e){return(new ElementManager).use(e)}find(e){return this.element=document.querySelector(e),this.element&&(this.found=!0),this}create(e){return this.bypass||(this.element=document.createElement(e)),this}replace(e){return this.replaced=document.querySelector(e),this}use(e){return this.element=e,this}or(){return this.bypass=this.found,this}then(){return this.bypass=!1,this}on(e){return this.bypass||this.element?.isConnected||("string"==typeof e?document.querySelector(e):e instanceof HTMLElement?e:document.body)?.append(this.element),this}set(e={},t={}){if(this.bypass)return this;function n(e){return e.match(/^(?:\$__)?(?<val>.+?)(?:__\$)?$/)?.groups?.val??e}return e&&Object.keys(e).forEach((t=>{const s=n(t),i=this.element?.getAttribute(s),r=e[t];t.endsWith("__$")?this.element.setAttribute(s,(i??"")+r):t.startsWith("$__")?this.element.setAttribute(s,r+i??""):this.element.setAttribute(s,r)})),t&&Object.keys(t).forEach((e=>{let s=n(e);const i="function"==typeof t[e]?t[e]:n=>e.endsWith("__$")?(n??"")+t[e]:e.startsWith("$__")?t[e]+(n??""):t[e];this.element[s]=i(this.element[s])})),this}with(e){return this.replaced?.replaceWith(e.element),e}move(e="body",t=1){if(this.bypass)return this;if(["in","out"].includes(e))return this[e](t);if(["up","down"].includes(e))for(;t>0;){const n="up"===e?this.element.previousElementSibling:this.element.nextElementSibling;if(!n)break;let s=[this.element,n];"down"===e&&(s=s.reverse()),this.element.parentNode.insertBefore(...s),t--}else document.querySelector(e)?.append(this.element);return this}up(e=1){return this.move("up",e)}down(e=1){return this.move("down",e)}out(e=1){if(this.bypass)return this;for(;e>0&&this.element.parentNode&&this.element.parentNode!==document.body;){const t=this.element.parentNode;t.parentNode&&t.parentNode.insertBefore(this.element,t.nextSibling),e--}return this}in(e=1){if(this.bypass)return this;for(;e>0;){const t=this.element.previousElementSibling;if(!t)break;t.appendChild(this.element),e--}return this}hide(e=!0){if(this.bypass)return this;const t=this.element?.getAttribute("style")??"",n=";/*hide--*/;display:none !important;/*--hide*/;";return e&&!t.includes(n)?this.set({style__$:";/*hide--*/;display:none !important;/*--hide*/;"}):!e&&t.includes(n)?this.set({style:t?.replace(/\/\*hide--\*\/;display:none !important;\/\*--hide\*\//,"")}):this}remove(){return this.bypass||this.element?.remove(),this}listen(e,t){return this.bypass||this.element?.addEventListener(e,t),this}trigger(e){return this.bypass||this.element?.dispatchEvent(new Event(e)),this}}const find=ElementManager.find,create=ElementManager.create,replace=ElementManager.replace,use=ElementManager.use;function ensureTailwindCss(){find("#nussl-core-tailwindcss").or().create("script").set({src:"https://cdn.tailwindcss.com",id:"nussl-core-tailwindcss"}).on(document.body)}function nusslCss(e){find("#nussl-core-css").or().create("style").set({type:"text/css",id:"nussl-core-css"},{textContent:e}).on(document.head)}